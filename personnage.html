<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Générateur de Traits - Eloth</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        .pixel-font {
            font-family: 'Press Start 2P', cursive;
        }
        .nes-button {
            /* Classic Eloth button style */
            background-color: #C82400; 
            box-shadow: 0 6px 0 #9E1C00; 
            transition: all 0.1s ease-in-out;
            cursor: pointer;
        }
        .nes-button:active {
            box-shadow: 0 2px 0 #9E1C00;
            transform: translateY(4px);
        }
        .text-glow {
            text-shadow: 0 0 5px rgba(252, 255, 0, 0.7);
        }
        
        /* Styling for the new top-left back button */
        #back-button-top {
            background-color: transparent;
            border: none;
            color: #FCFF00; /* Eloth Yellow for visibility */
            font-size: 2rem;
            line-height: 1.5rem;
            padding: 0.5rem;
            cursor: pointer;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            transition: color 0.2s ease; 
        }

        #back-button-top:hover {
            color: #ffffff; /* White on hover */
        }
        
        /* Ensures body and HTML cover full viewport and background is black */
        html, body {
            height: 100%;
            margin: 0;
            background-color: black;
        }

        /* Style for narrative summary results */
        .code-result {
            display: inline-block;
            background-color: #C82400; /* Red background */
            color: #FCFF00; /* Yellow text */
            font-family: monospace;
            padding: 1px 4px;
            margin: 0 4px;
            border: 1px solid #FCFF00;
            border-radius: 2px;
            white-space: nowrap; /* Prevent result from breaking line */
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'eloth-red': '#C82400',
                        'eloth-yellow': '#FCFF00',
                    },
                }
            }
        }
    </script>
</head>
<body class="bg-black text-white antialiased min-h-screen flex flex-col items-center p-4 relative">
    
    <button 
        id="back-button-top" 
        class="absolute top-4 left-4 z-50 pixel-font" 
        onclick="window.history.back()"
    >
        &lt;
    </button>
    
    <h1 class="pixel-font text-eloth-yellow text-3xl md:text-4xl lg:text-5xl mt-8 mb-4 text-center text-glow">
        GÉNÉRATEUR DE TRAITS D'ELOTH
    </h1>
    
    <p class="text-center text-gray-400 mb-8 font-mono max-w-2xl">
        Génération automatique des caractéristiques physiques et d'arrière-plan.
    </p>

    <div class="w-full max-w-sm md:max-w-md lg:max-w-lg mb-10">
        <button 
            type="button"
            id="generate-button"
            onclick="generateFullCharacter()"
            class="nes-button w-full text-black bg-eloth-yellow pixel-font text-xl md:text-2xl px-6 py-4 rounded-xl border-none shadow-md"
        >
            Générer les Traits
        </button>
    </div>

    <div id="character-output" class="w-full max-w-4xl mx-auto hidden transition duration-300 transform scale-95 opacity-0 bg-gray-900 p-6 md:p-10 rounded-lg border-4 border-eloth-red shadow-2xl">
        
        <h2 class="pixel-font text-eloth-yellow text-2xl md:text-3xl mb-6 text-center text-glow">
            CARACTÉRISTIQUES GÉNÉRÉES
        </h2>
        
        <div id="metadata-list" class="space-y-4 text-lg font-mono">
            </div>

        <div class="mt-8 pt-4 border-t border-gray-700">
            <h3 class="pixel-font text-eloth-red text-xl mb-3">HISTORIQUE EN BREF :</h3>
            <p id="summary-description" class="text-gray-200 text-base leading-relaxed"></p>
        </div>

    </div>

    <script>
        // --- TABLES D12 (Âge, Yeux, Signe, Poids, Taille, Cheveux, Famille, Région) ---
        
        // Âge, Yeux, Signe distinctif (D12)
        const AGE_EYES_SIGN_TABLE = [
            [2, { age: "Inférieur à 20 ans", eyes: "Noirs", sign: "Oreille coupée" }],
            [4, { age: "Entre 20 et 25 ans", eyes: "Marrons", sign: "Odeur forte" }],
            [6, { age: "Entre 25 et 30 ans", eyes: "Olives", sign: "Grain de beauté" }],
            [8, { age: "Entre 30 et 35 ans", eyes: "Verts", sign: "Tâches de rousseur" }],
            [10, { age: "Entre 35 et 40 ans", eyes: "Bleus", sign: "Cicatrice" }],
            [12, { age: "Supérieur à 40 ans", eyes: "Azurs", sign: "Dent cassée" }]
        ];
        
        // Poids et Taille (D12)
        const WEIGHT_SIZE_TABLE = [
            [2, { weight: "Inférieur à 50 kg", size: "Inférieur à 1m50" }],
            [4, { weight: "Entre 50 et 60 kg", size: "Entre 1m50 et 1m60" }],
            [6, { weight: "Entre 60 et 70 kg", size: "Entre 1m60 et 1m70" }],
            [8, { weight: "Entre 70 et 80 kg", size: "Entre 1m70 et 1m80" }],
            [10, { weight: "Entre 80 et 90 kg", size: "Entre 1m80 et 1m90" }],
            [12, { weight: "Supérieur à 90 kg", size: "Supérieur à 1m90" }]
        ];

        // Cheveux (Coupe Type 1, Coupe Type 2, Couleur) - D12 pour la Couleur
        const HAIR_CUTS = [
            [2, { cut_1: "Crâne rasé", cut_2: "Rasé sur les côtés" }],
            [4, { cut_1: "Court", cut_2: "Court avec frange" }],
            [6, { cut_1: "Coupe au bol", cut_2: "Au carré" }],
            [8, { cut_1: "Mi-longs", cut_2: "Queue de cheval" }],
            [10, { cut_1: "Queue de cheval", cut_2: "Tressés" }],
            [12, { cut_1: "Longs et lâchés", cut_2: "Longs et lâchés" }]
        ];
        const HAIR_COLOR_TABLE = [
            [2, "Noir"], [4, "Brun"], [6, "Châtain"], 
            [8, "Roux"], [10, "Blond"], [12, "Blanc"]
        ];
        
        // Région (D12)
        const REGION_TABLE = [
            [2, "Hautbade"], [4, "Venetir"], [6, "Sybna"], [8, "Austral"], [10, "Oxydia"], [12, "Inconnue"]
        ];
        
        // Famille (D12) - Les résultats sont groupés par 4 pour chaque région.
        const FAMILY_TABLE = [
            // Hautbade (Roll 1-2)
            { rollMax: 3, region: "Hautbade", result: "Famille de commerçants" }, 
            { rollMax: 6, region: "Hautbade", result: "Voyageurs pour représentations artistiques" }, 
            { rollMax: 9, region: "Hautbade", result: "Famille d'artisans" }, 
            { rollMax: 12, region: "Hautbade", result: "Famille enlevée par la Confrérie" }, 
            // Venetir (Roll 3-4)
            { rollMax: 3, region: "Venetir", result: "Famille de criminels" }, 
            { rollMax: 6, region: "Venetir", result: "Opposants au pouvoir en place" }, 
            { rollMax: 9, region: "Venetir", result: "Recueilli(e) par un pêcheur" }, 
            { rollMax: 12, region: "Venetir", result: "Tous les membres massacrés" }, 
            // Sybna (Roll 5-6)
            { rollMax: 3, region: "Sybna", result: "Tous les membres sont en vie" }, 
            { rollMax: 6, region: "Sybna", result: "Partis dans une autre région" }, 
            { rollMax: 9, region: "Sybna", result: "Certains membres tués par une créature" }, 
            { rollMax: 12, region: "Sybna", result: "Grandi(e) dans un sanctuaire de l'Eloth" }, 
            // Austral (Roll 7-8)
            { rollMax: 3, region: "Austral", result: "Famille noble" }, 
            { rollMax: 6, region: "Austral", result: "Famille noble qui soutient la Confrérie" }, 
            { rollMax: 9, region: "Austral", result: "Famille d'agriculteurs" }, 
            { rollMax: 12, region: "Austral", result: "A fui sa famille" }, 
            // Oxydia (Roll 9-10)
            { rollMax: 3, region: "Oxydia", result: "Recueilli(e) par une caravane marchande" }, 
            { rollMax: 6, region: "Oxydia", result: "Vit en ermite" }, 
            { rollMax: 9, region: "Oxydia", result: "Tous les membres sont morts" }, 
            { rollMax: 12, region: "Oxydia", result: "Fait partie d'un groupe de hors-la-loi" }, 
            // Inconnue (Roll 11-12)
            { rollMax: 3, region: "Inconnue", result: "Recueilli(e) par une caravane marchande" }, 
            { rollMax: 6, region: "Inconnue", result: "Vit en ermite" }, 
            { rollMax: 9, region: "Inconnue", result: "Tous les membres sont morts" }, 
            { rollMax: 12, region: "Inconnue", result: "Fait partie d'un groupe de hors-la-loi" }
        ];

        // Lieu de naissance (D100)
        const BIRTHPLACE_TABLE = [
            [20, "Désert"], [40, "Montagne"], [50, "Ville"], [60, "Ruelle (Bas-fonds)"], 
            [70, "Forêt"], [80, "Village"], [90, "Marais"], [95, "Ruine Antique"], 
            [99, "Un Autre Plan"], [100, "Prison"]
        ];

        // Mauvaise Fortune (D10)
        const BAD_FORTUNE_TABLE = [
            [1, "Vous êtes maudit. Jetez un dé dans le tableau des maladies ou des malédictions (page 37)."],
            [2, "Vous êtes malade. Jetez un dé dans le tableau des maladies ou des malédictions (page 37)."],
            [3, "Vous avez une dette d'une valeur de 1D20 écus d'or."],
            [4, "Vous êtes recherché par les chasseurs de primes. Cette accusation peut être fausse."],
            [5, "Vous avez une addiction pour quelque chose. Vous êtes libre de choisir laquelle."],
            [6, "Vous êtes porteur d'un handicap. Jetez un dé dans le tableau (page 35)."],
            [7, "Vous êtes en conflit avec une personne."],
            [8, "Votre argent est divisé par deux."],
            [9, "Vous ne savez ni lire ni écrire."],
            [10, "Vous avez un malus non permanent de -1 sur vos jets lors du premier scénario."]
        ];

        // Bonne Fortune (D10)
        const GOOD_FORTUNE_TABLE = [
            [1, "Vous pouvez choisir un objet spécifique dans la liste des objets (page 67)."],
            [2, "Vous obtenez un grand sac de voyage."],
            [3, "Vous avez suivi les enseignements d'une personne et vous obtenez 1D4 points de compétence en plus."],
            [4, "Vous commencez avec une arme."],
            [5, "Vous démarrez votre aventure avec un animal de votre choix."],
            [6, "Vous avez suivi un entraînement à une catégorie d'arme."],
            [7, "Vous bénéficiez d'une compétence niveau 1 d'un autre métier."],
            [8, "Vous avez obtenu un héritage d'une valeur de 1D10 écus d'or. Cet objet appartenait à votre famille."],
            [9, "Vous commencez avec une armure complète de maille."],
            [10, "Vous avez obtenu les faveurs d'un maître de l'eloth. Si vous êtes disciple, vous avez le D8 pour incanter l'eloth, sinon vous avez un D6."]
        ];


        // --- Utility Functions ---

        /**
         * Simulates a dice roll.
         * @param {number} max The maximum value of the die (e.g., 100 for D100, 10 for D10, 12 for D12).
         * @returns {number} The result of the roll.
         */
        function rollDice(max) {
            return Math.floor(Math.random() * max) + 1;
        }

        /**
         * Finds the result in a generic table based on a dice roll.
         * @param {number} roll The dice roll result.
         * @param {Array<[number, string|object]>} table The table of [maxRoll, result] pairs.
         * @returns {string|object} The corresponding result description or object.
         */
        function getResultFromTable(roll, table) {
            for (const [maxRoll, result] of table) {
                if (roll <= maxRoll) {
                    return result;
                }
            }
            return "Indéterminé (Erreur de Table)";
        }
        
        /**
         * Finds the result for the family table based on region and family roll.
         * @param {string} region The generated region string (e.g., "Hautbade").
         * @param {number} familyRoll The dice roll result (1-12) used for the family.
         * @returns {string} The corresponding family description.
         */
        function getFamilyResult(region, familyRoll) {
            // Find the index range in the FAMILY_TABLE corresponding to the region
            const familyRows = FAMILY_TABLE.filter(row => row.region === region);
            
            if (familyRows.length === 0) return "Origine familiale inconnue.";

            // Use the D12 roll to determine the result within the region's 4 rows
            for (const row of familyRows) {
                if (familyRoll <= row.rollMax) {
                    return row.result;
                }
            }
            
            return familyRows[familyRows.length - 1].result; 
        }

        /**
         * Handles the combined Cheveux (Hair) table roll (1-24) and the color (D12).
         * @param {number} roll The dice roll result (1-24).
         * @returns {object} { cut: string, color: string, roll: number, colorRoll: number }
         */
        function getHairResult(roll) {
            // 1. Determine Hair Color (D12 independent roll)
            const colorRoll = rollDice(12); 
            const colorResult = getResultFromTable(colorRoll, HAIR_COLOR_TABLE);
            
            // 2. Determine Hair Cut (D24 combined roll)
            let cut;
            let cutRollReference; // The D12 roll for the specific cut row

            if (roll <= 12) {
                // Type 1: Roll 1-12
                cutRollReference = roll;
                const resultObj = getResultFromTable(roll, HAIR_CUTS);
                cut = resultObj.cut_1;
            } else {
                // Type 2: Roll 13-24, reference the row using roll - 12
                cutRollReference = roll - 12;
                const resultObj = getResultFromTable(cutRollReference, HAIR_CUTS);
                cut = resultObj.cut_2;
            }
            
            return { 
                cut: cut, 
                color: colorResult, 
                roll: roll, 
                colorRoll: colorRoll 
            };
        }
        
        // Helper function to wrap text in the code style
        function formatResult(text) {
            return `<code class="code-result">${text}</code>`;
        }
        
        // --- Core Generation Function ---

        const characterOutput = document.getElementById('character-output');
        const metadataList = document.getElementById('metadata-list');
        const summaryDescription = document.getElementById('summary-description');
        
        function generateFullCharacter() {
            // --- Tirages D12, D100 et D24 ---
            
            // Âge, Yeux, Signe (D12)
            const rollAgeEyesSign = rollDice(12);
            const ageEyesSignResult = getResultFromTable(rollAgeEyesSign, AGE_EYES_SIGN_TABLE);
            
            // Poids et Taille (D12)
            const rollWeightSize = rollDice(12);
            const weightSizeResult = getResultFromTable(rollWeightSize, WEIGHT_SIZE_TABLE);

            // Lieu de naissance (D100)
            const rollBirthplace = rollDice(100);
            const birthplace = getResultFromTable(rollBirthplace, BIRTHPLACE_TABLE);

            // Cheveux (D24 pour la coupe, D12 interne pour la couleur)
            const rollHair = rollDice(24);
            const hairResult = getHairResult(rollHair);
            
            // Région (D12)
            const rollRegion = rollDice(12);
            const region = getResultFromTable(rollRegion, REGION_TABLE);

            // Famille (D12)
            const rollFamily = rollDice(12);
            // La table des familles dépend du résultat de la Région
            const family = getFamilyResult(region, rollFamily);

            // Fortune (D10 x 2)
            const rollGoodFortune = rollDice(10);
            const goodFortune = getResultFromTable(rollGoodFortune, GOOD_FORTUNE_TABLE);
            
            const rollBadFortune = rollDice(10);
            const badFortune = getResultFromTable(rollBadFortune, BAD_FORTUNE_TABLE);


            // 2. Prepare the output data structure
            const attributes = [
                { label: "Âge", value: ageEyesSignResult.age, roll: rollAgeEyesSign, max: 12 },
                { label: "Taille", value: weightSizeResult.size, roll: rollWeightSize, max: 12 },
                { label: "Poids", value: weightSizeResult.weight, roll: rollWeightSize, max: 12 },
                { label: "Yeux", value: ageEyesSignResult.eyes, roll: rollAgeEyesSign, max: 12 },
                { 
                    label: "Cheveux", 
                    value: `${hairResult.cut} (${hairResult.color})`, 
                    // Afficher les deux rolls: D24 pour la coupe et D12 pour la couleur
                    roll: `${hairResult.roll}, C:${hairResult.colorRoll}`, 
                    max: "24/12"
                },
                { label: "Signe Distinctif", value: ageEyesSignResult.sign, roll: rollAgeEyesSign, max: 12 },
                { label: "Région", value: region, roll: rollRegion, max: 12 },
                { label: "Lieu de Naissance", value: birthplace, roll: rollBirthplace, max: 100 },
                { label: "Famille", value: family, roll: rollFamily, max: 12 },
                { label: "Bonne Fortune", value: goodFortune, roll: rollGoodFortune, max: 10 },
                { label: "Mauvaise Fortune", value: badFortune, roll: rollBadFortune, max: 10 },
            ];

            // 3. Generate HTML for the list
            metadataList.innerHTML = attributes.map(attr => `
                <li class="grid grid-cols-3 md:grid-cols-5 gap-2 border-b border-gray-800 pb-2">
                    <span class="pixel-font text-eloth-yellow col-span-2 md:col-span-1">${attr.label} :</span>
                    <span class="col-span-3 md:col-span-3 text-white">${attr.value}</span>
                    <span class="col-span-3 md:col-span-1 text-eloth-red text-right">${attr.roll ? `(D${attr.max}: ${attr.roll})` : ''}</span>
                </li>
            `).join('');

            // 4. Generate the narrative summary with code styling
            summaryDescription.innerHTML = 
                `Ce personnage est âgé de ${formatResult(ageEyesSignResult.age)} et vient de la région de ${formatResult(region)}. 
                Il/Elle est né(e) à/dans ${formatResult(birthplace)}.
                Il/Elle mesure ${formatResult(weightSizeResult.size)} et pèse ${formatResult(weightSizeResult.weight)}. 
                Physiquement, il/elle a une coupe ${formatResult(hairResult.cut)} de couleur ${formatResult(hairResult.color)} et des yeux ${formatResult(ageEyesSignResult.eyes)}.
                Son signe distinctif est : ${formatResult(ageEyesSignResult.sign)}.
                Son historique familial est : ${formatResult(family)}.
                <br><br>
                Le destin lui a accordé une Bonne Fortune : ${formatResult(goodFortune)}.
                Il/Elle doit aussi faire face à une Mauvaise Fortune : ${formatResult(badFortune)}.`;

            // 5. Display the output with a flourish
            characterOutput.classList.remove('hidden', 'scale-95', 'opacity-0');
            characterOutput.classList.add('scale-100', 'opacity-100');
        }

        // --- Initialization ---
        window.onload = function() {
            // Nothing special needed for now
        };

    </script>
</body>
</html>